<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Uncountable Nouns Finder</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Nunito:wght@400;700;900&display=swap" rel="stylesheet">
  <style>
    :root{ --bg:#ffffff; --ink:#0e0f12; --accent:#6c5ce7; --accent-2:#00d1ff; --good:#00c853; --bad:#ff1744; --muted:#dfe6e9; --glass: rgba(255,255,255,0.85); }
    *{box-sizing:border-box}
    body{ margin:0; background:var(--bg); color:var(--ink); font-family: Nunito, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial; }

    header{ display:flex; align-items:center; justify-content:space-between; gap:1rem; padding:1rem clamp(1rem,3vw,2rem); position:sticky; top:0; z-index:10; background:linear-gradient(180deg, rgba(255,255,255,0.95), rgba(255,255,255,0.75)); backdrop-filter: blur(8px); border-bottom:1px solid var(--muted);}    
    .brand{display:flex; align-items:center; gap:.8rem}
    .brand .logo{ width:42px; height:42px; border-radius:12px; display:grid; place-items:center; background: radial-gradient(circle at 30% 30%, var(--accent-2), var(--accent)); color:white; font-family: "Press Start 2P"; font-size: .9rem; box-shadow: 0 8px 24px rgba(0,0,0,.12); }
    .brand h1{font-size:clamp(1rem, 2.5vw, 1.4rem); margin:0; font-weight:900}
    .controls{display:flex; gap:.5rem; flex-wrap:wrap; align-items:center}
    button{ border:0; padding:.75rem 1rem; border-radius:999px; cursor:pointer; font-weight:800; background:linear-gradient(135deg, var(--accent), var(--accent-2)); color:white; box-shadow: 0 8px 24px rgba(108,92,231,.35); transition: transform .06s ease, box-shadow .2s ease, opacity .2s ease; user-select:none; }
    button.secondary{ background:linear-gradient(135deg, #b2bec3, #636e72); box-shadow:0 8px 24px rgba(99,110,114,.25); }
    button:hover{ transform: translateY(-1px); }

    main{ max-width: min(1100px, 95vw); margin: 1rem auto 3rem; padding: 0 1rem; }

    .hud{ display:grid; grid-template-columns: 1fr; gap:1.1rem; background:var(--glass); border:1px solid var(--muted); padding:1rem; border-radius:16px; box-shadow:0 8px 30px rgba(0,0,0,.06); }

    /* Attempts dotted bar */
    .attempts-row{ display:flex; align-items:center; justify-content:space-between; gap:.75rem; margin-bottom:.5rem; }
    .attempts-label{ font-weight:900; }
    .attempts-dots{ display:flex; gap:.5rem; }
    .dot{ width:16px; height:16px; border-radius:50%; border:2px dotted #95a5a6; background: transparent; transition: .2s ease; }
    .dot.used{ background: var(--bad); border-color: var(--bad); }

    /* Words segmented bar */
    .segments{ display:flex; gap:8px; height:16px; }
    .seg{ flex:1; border:1px solid var(--muted); border-radius:8px; background:#ecf0f1; overflow:hidden; transition:.2s ease; }
    .seg.fill{ background: linear-gradient(90deg, var(--good), #9cffb5); }

    .game-wrap{ margin-top:1rem; position:relative; border-radius:18px; overflow:hidden; border:1px solid var(--muted); box-shadow:0 16px 50px rgba(0,0,0,.08); background:white; }
    .stage{ position:relative; width:100%; aspect-ratio: 16 / 9; background:#f8fafc; }
    .stage img{ width:100%; height:100%; object-fit:cover; display:block; user-select:none; pointer-events:none; }
    .overlay{ position:absolute; inset:0; cursor: crosshair; } .overlay.hover-target{ cursor: zoom-in; }

    .panel{ margin-top:.75rem; display:flex; gap:.5rem; flex-wrap:wrap; align-items:center; }
    .win, .lose{ display:none; font-weight:900; }
    .win.show, .lose.show{ display:inline-block; }

    /* Modal */
    .modal{ position: fixed; inset:0; display:none; align-items:center; justify-content:center; background: rgba(0,0,0,.45); z-index:200; }
    .modal.open{ display:flex; }
    .card{ background:white; width:min(560px, 92vw); border-radius:16px; padding:1rem; border:1px solid var(--muted); box-shadow:0 16px 50px rgba(0,0,0,.18); }
    .card h2{ margin:.25rem 0 .5rem; }
    .card p{ margin:.25rem 0 .75rem; }
    .row{ display:flex; gap:.5rem; align-items:center; justify-content:flex-end; flex-wrap:wrap; }
  .magnifier{ position:absolute; width:84px; height:84px; border-radius:50%; border:2px solid var(--accent); box-shadow:0 6px 18px rgba(0,0,0,.2); pointer-events:none; display:none; background-repeat:no-repeat; background-size:200% 200%; }
  </style>
</head>
<body>
  <header>
    <div class="brand">
      <div class="logo">UN</div>
      <h1>Uncountable Nouns Finder</h1>
    </div>
    <div class="controls">
      <button id="resetBtn" class="secondary">Reset</button>
    </div>
  </header>

  <main>
    <div class="hud">
      <div class="attempts-row">
        <div class="attempts-label">Attempts</div>
        <div class="attempts-dots" id="attemptDots"></div>
      </div>
      <div class="segments" aria-label="Words progress">
        <div class="seg" id="seg1"></div>
        <div class="seg" id="seg2"></div>
        <div class="seg" id="seg3"></div>
      </div>
    </div>

    <div class="game-wrap">
      <div class="stage" id="stage">
        <img id="scene" src="https://raw.githubusercontent.com/ik3057823-ops/images-5/refs/heads/main/liv%20room.png" alt="Scene" crossorigin="anonymous" />
        <div class="overlay" id="overlay" aria-label="Click items in the image"></div>
      </div>
      <div id="magnifier" class="magnifier"></div>
    </div>

    <div class="panel" aria-live="polite">
      <span class="win" id="win">ðŸŽ‰ You found all uncountables!</span>
      <span class="lose" id="lose">ðŸ˜µ Out of attempts. Try again.</span>
    </div>
  </main>

  <!-- Reused intro & feedback modal -->
  <div class="modal" id="modal">
    <div class="card">
      <h2 id="modalTitle">How to play</h2>
      <p id="modalBody">Click items in the picture to find three <strong>uncountable</strong> nouns. You have <strong>five</strong> clicks. The top row shows your <em>attempts</em> as dots. The second row fills up as you find the uncountable nouns. Tap <strong>Continue</strong> to begin the game.</p>
      <div class="row">
        <button id="modalClose">Continue</button>
      </div>
    </div>
  </div>

<script>
(function(){
  const overlay = document.getElementById('overlay');
  const stage = document.getElementById('stage');
  const attemptDotsEl = document.getElementById('attemptDots');
  const segs = [document.getElementById('seg1'), document.getElementById('seg2'), document.getElementById('seg3')];
  const winEl = document.getElementById('win');
  const loseEl = document.getElementById('lose');
  const resetBtn = document.getElementById('resetBtn');
  const magnifier = document.getElementById('magnifier');

  const modal = document.getElementById('modal');
  const modalTitle = document.getElementById('modalTitle');
  const modalBody = document.getElementById('modalBody');
  const modalClose = document.getElementById('modalClose');

  const attemptsMax = 5;
  let attempts = attemptsMax; // remaining
  let found = new Set();
  let playing = false;
  let introOpen = true;

  // prepare magnifier background to match the image
  const sceneImg = document.getElementById('scene');
  magnifier.style.backgroundImage = `url('${sceneImg.src}')`;

  // Target regions (percent of stage) for the specified image
  // money on the carpet (any), salt on the round table, food (meals) on the table
  const targets = [
    // Tuned to your circled areas on the provided image
    { id:'MONEY', x:18, y:76, w:26, h:16 }, // cash on left-bottom carpet
    { id:'SALT',  x:49, y:57, w:14, h:18 }, // salt shaker on the round coffee table center
    { id:'FOOD',  x:79, y:62, w:18, h:16 }  // plates/bowls on the right table
  ];

  function renderAttemptDots(){
    attemptDotsEl.innerHTML = '';
    const used = attemptsMax - attempts;
    for(let i=0;i<attemptsMax;i++){
      const d = document.createElement('div');
      d.className = 'dot' + (i < used ? ' used' : '');
      attemptDotsEl.appendChild(d);
    }
  }

  function renderSegments(){
    segs.forEach((seg, i)=>{ seg.classList.toggle('fill', i < found.size); });
  }

  function openModal(title, body, btn='Continue'){
    modalTitle.textContent = title; modalBody.innerHTML = body; modalClose.textContent = btn; modal.classList.add('open');
  }
  function closeModal(){ modal.classList.remove('open'); }

  function percentToPx(box){
    const rect = overlay.getBoundingClientRect();
    return { left: box.x/100*rect.width, top: box.y/100*rect.height, width: box.w/100*rect.width, height: box.h/100*rect.height };
  }
  function hit(box, clientX, clientY){
    const rect = overlay.getBoundingClientRect();
    const x = clientX - rect.left, y = clientY - rect.top;
    const b = percentToPx(box);
    return x>=b.left && x<=b.left+b.width && y>=b.top && y<=b.top+b.height;
  }

  function startGame(){
    playing = true; attempts = attemptsMax; found.clear();
    winEl.classList.remove('show'); loseEl.classList.remove('show');
    renderAttemptDots(); renderSegments();
  }

  function win(){ playing=false; winEl.classList.add('show'); openModal('Great job!','You found all <strong>uncountable</strong> nouns. ðŸŽ‰','Play again'); }
  function lose(){ playing=false; loseEl.classList.add('show'); openModal('Out of attempts','No more clicks left. Give it another go!','Try again'); }

  // Intro modal, start game on Continue
  openModal('How to play','Click items in the picture to find three <strong>uncountable</strong> nouns. You have <strong>five</strong> clicks. The top row shows your attempts as dots. The second row fills up as you find the nouns. Tap <strong>Continue</strong> to begin.','Continue');
  modalClose.addEventListener('click', ()=>{
    closeModal();
    if(introOpen){ startGame(); introOpen=false; }
    else if(!playing && (found.size===targets.length || attempts<=0)){ startGame(); }
  });

  resetBtn.addEventListener('click', ()=>{ startGame(); });

  overlay.addEventListener('click', (e)=>{
    if(!playing){ openModal('Tap Continue','Press <strong>Continue</strong> to start the game.'); return; }
    if(found.size===targets.length) return;

    let got=null;
    for(const t of targets){ if(found.has(t.id)) continue; if(hit(t, e.clientX, e.clientY)){ got=t; break; } }

    if(got){
      found.add(got.id); renderSegments();
      openModal('Correct','That is an <strong>uncountable</strong> noun. Nice find!');
      if(found.size===targets.length) win();
    } else {
      attempts = Math.max(0, attempts-1); renderAttemptDots();
      if(attempts<=0) { lose(); } else { openModal('Not this one','This looks like a <strong>countable</strong> thing (e.g., a table, sofa, or lamp). Keep exploring!'); }
    }
  });

  // Magnifier + hover detection
  overlay.addEventListener('mousemove', (e)=>{
    const rect = overlay.getBoundingClientRect();
    const x = e.clientX - rect.left; const y = e.clientY - rect.top;
    const overTarget = targets.some(t=> !found.has(t.id) && hit(t, e.clientX, e.clientY));
    overlay.classList.toggle('hover-target', overTarget);
    if(overTarget){
      const pctX = (x/rect.width)*100; const pctY = (y/rect.height)*100;
      magnifier.style.left = (x-42)+'px'; magnifier.style.top = (y-42)+'px';
      magnifier.style.backgroundPosition = pctX+'% '+pctY+'%';
      magnifier.style.display = 'block';
    } else {
      magnifier.style.display = 'none';
    }
  });
  overlay.addEventListener('mouseleave', ()=>{ magnifier.style.display='none'; overlay.classList.remove('hover-target'); });

  // Initial bars
  renderAttemptDots(); renderSegments();
})();
</script>
</body>
</html>
